<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MK Dashboard</title>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ======================== RESET ======================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background: #0f0f1a;
            color: #fff;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* ======================== SIDEBAR ======================== */
        .sidebar {
            width: 260px;
            background: #111;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar .logo {
            width: 140px;
            margin-bottom: 40px;
            user-select: none;
        }

        .sidebar button {
            display: flex;
            align-items: center;
            gap: 14px;
            background: none;
            border: none;
            border-left: 4px solid transparent;
            border-radius: 8px;
            color: #fff;
            padding: 14px 12px;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .sidebar button:hover,
        .sidebar button.active {
            background: #1a1a1a;
            border-left: 4px solid #ff0000;
        }

        /* ======================== SIDEBAR USER ======================== */
        .sidebar {
            display: flex;
            flex-direction: column;
            height: 100vh;
            /* ocupa toda a altura da tela */
            padding: 20px;
            background-color: #111;
            width: 260px;
            /* exemplo escuro */
            box-sizing: border-box;
        }

        /* Bot√µes do menu ocupam espa√ßo natural, mas empurram o usu√°rio para baixo */
        .sidebar>button {
            background: none;
            border: none;
            color: #eee;
            padding: 12px 16px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 8px;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .sidebar>button:hover,
        .sidebar>button.active {
            color: #fff;
        }

        /* O box do usu√°rio fica grudado embaixo */
        .sidebar-user {
            margin-top: auto;
            /* empurra pra baixo */
            padding-top: 15px;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #eee;
            gap: 10px;
        }

        /* user-info alinhado √† esquerda */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Imagem do usu√°rio */
        .user-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ff4d4d;
            box-shadow: 0 0 8px #ff4d4d;
        }

        /* Texto com nome e id lado a lado */
        .user-text {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }

        .user-text>div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1rem;
            color: #eee;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ID estilo */
        #userIdSidebar {
            font-size: 0.9em;
            color: #aaa;
            user-select: text;
        }

        /* Cargo do usu√°rio embaixo - estilo simples e discreto */
        #userCargoSidebar {
            font-size: 12px;
            margin-top: 6px;
            background-color: rgba(255,255,255,0.04);
            color: #ddd;
            padding: 4px 8px;
            border-radius: 10px;
            font-weight: 600;
            display: inline-block;
            line-height: 1;
        }

        /* Bot√µes de a√ß√£o do usu√°rio (configura√ß√µes e logout) */
        .user-actions {
            display: flex;
            gap: 8px;
        }

        .user-actions button {
            background: none;
            border: none;
            color: #eee;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .user-actions button:hover {
            color: #fff;
        }

        /* Hover espec√≠fico: logout deve ficar vermelho, settings deve ficar com tom discord */
        .user-actions button#btnLogoutIcon:hover {
            background-color: #ff4d4d;
            color: #fff;
        }

        .user-actions button#btnSettings:hover {
            background-color: rgba(88,101,242,0.12);
            color: #fff;
        }

        /* Desabilitado visual para inputs do modal */
        .settings-input:disabled,
        .settings-select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Logo no topo da sidebar */
        .sidebar>img.logo {
            width: 120px;
            margin-bottom: 20px;
            user-select: none;
        }

        /* ======================== MAIN CONTENT ======================== */
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: linear-gradient(135deg, #1b1b2f, #0f0f1a);
            transition: all 0.3s ease;
        }

        header.dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
        }

        header.dashboard-header h2 {
            font-weight: 600;
            color: #fff;
            font-size: 24px;
            user-select: none;
        }

        /* ======================== BADGES DE CARGO ======================== */
        .badgeCargo {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            text-align: center;
            user-select: none;
            background-color: #1e1e2f;
            /* fundo escuro */
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        /* Overlay animado da borda */
        .badgeCargo::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            border-radius: 20px;
            z-index: -1;
            background-size: 200% 200%;
            animation: borderGlow 3s linear infinite;
            -webkit-mask-composite: destination-out;
            mask-composite: exclude;
        }

        /* Anima√ß√£o da borda */
        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Borda animada por cargo */
        .badgeCEO::before {
            background: linear-gradient(270deg, #ff4d4d, #ff9900, #ff4d4d);
        }

        .badgeAdmin::before {
            background: linear-gradient(270deg, #3498db, #00d4ff, #3498db);
        }

        .badgeModerador::before {
            background: linear-gradient(270deg, #2ecc71, #66ff66, #2ecc71);
        }

        .badgeUser::before {
            background: linear-gradient(270deg, #7f8c8d, #ccc, #7f8c8d);
        }

        /* ======================== CARDS ======================== */
        .card {
            background: #1e1e2f;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;

            transition: all 0.3s ease;
        }

        .card h3 {
            margin-bottom: 20px;
            color: #ff4d4d;
        }

        /* ======================== STATS GRID ======================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(145deg, #1e1e2f, #141423);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 28px;
            color: #ff4d4d;
        }

        .stat-card p {
            font-size: 14px;
            color: #ccc;
        }

        .stat-icon {
            font-size: 28px;
            color: #ff4d4d;
            background: rgba(255, 0, 0, 0.1);
            padding: 12px;
            border-radius: 10px;
        }

        /* ======================== CHAMPIONSHIP GRID ======================== */
        .championship-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .championship-card {
            background: #1e1e2f;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .championship-card:hover {
            transform: translateY(-6px);
        }

        .championship-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #ff4d4d;
            margin-bottom: 15px;
        }

        .championship-body small {
            color: #bbb;
        }

        /* ======================== PLAYERS GRID ======================== */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* ======================== ADMIN GRID ======================== */
        .admin-dashboard {
            display: flex;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
        }

        /* SIDEBAR */
        .admin-sidebar {
            width: 240px;
            background: linear-gradient(180deg, #1f1f1f, #121212);
            color: white;
            padding: 25px;
        }

        .admin-sidebar h2 {
            margin-bottom: 30px;
            color: #ff4d4d;
        }

        .admin-sidebar ul {
            list-style: none;
            padding: 0;
        }

        .admin-sidebar li {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .admin-sidebar li.active {
            background: linear-gradient(90deg, #ff4d4d, #ff1a1a);
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        /* CONTENT */
        .admin-content {
            flex: 1;
            padding: 30px;
            background: #0f0f0f;
            color: white;
            overflow-y: auto;
        }

        /* HEADER */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        /* STATS */
        .admin-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            flex: 1;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 0 15px rgba(255, 77, 77, 0.2);
        }

        .stat-card h3 {
            font-size: 28px;
            color: #ff4d4d;
        }

        /* TABLE */
        .admin-table-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
        }

        .table-header {
            margin-bottom: 15px;
        }

        .table-header input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: #111;
            color: white;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        #adminTable {
            width: 100%;
            border-collapse: collapse;
        }

        #adminTable th {
            text-align: left;
            padding: 12px;
            background: #111;
        }

        #adminTable td {
            padding: 12px;
            border-bottom: 1px solid #222;
        }

        #adminTable tr:hover {
            background: #222;
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .action-btn {
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 5px;
        }

        .edit-btn {
            background: #3498db;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .view-btn {
            background: #444;
            color: white;
        }

        /* ======================== TABLES ======================== */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background: #ff0000;
            color: #fff;
            border-radius: 8px 8px 0 0;
        }

        tr:nth-child(even) {
            background: #1a1a1a;
        }

        tr:hover {
            background: #222;
        }

        /* ======================== FORMS ======================== */
        input,
        select {
            width: 100%;
            padding: 12px 14px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
            background: #111;
            color: #fff;
            outline: none;
        }

        button.primary {
            background: #ff0000;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            border: none;
            transition: 0.3s;
        }

        button.primary:hover {
            background: #cc0000;
        }

        button.delete-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: background 0.3s, transform 0.2s;
        }

        button.delete-btn:hover {
            background: #aa0000;
            transform: translateY(-2px);
        }

        /* ======================== TEAM BOX / CHAVES ======================== */
        #chavesContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .team-box {
            background: #1e1e2f;
            padding: 20px;
            border-radius: 12px;
            border-left: 6px solid #ff0000;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex: 1 1 200px;
            transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
        }

        .team-box:hover {
            background: #111;
            transform: translateY(-3px);
        }

        .team-box strong {
            font-size: 16px;
            font-weight: 700;
            color: #ff4d4d;
            margin-bottom: 8px;
        }

        .team-box small {
            font-size: 13px;
            color: #bbb;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .team-box div {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ======================== TEMA CLARO ======================== */
        body.light {
            background: #f4f4f4;
            color: #111;
        }

        body.light .main {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
        }

        body.light .sidebar {
            background: #fff;
            color: #111;
            box-shadow: 3px 0 20px rgba(255, 77, 77, 0.2);
        }

        body.light .sidebar button {
            color: #111;
        }

        body.light .sidebar button:hover,
        body.light .sidebar button.active {
            background: #eee;
            border-left: 4px solid #ff0000;
        }

        body.light .user-actions button {
            background: #eaeaea;
            color: #111;
        }

        body.light .user-actions button:hover {
            background: #ff0000;
            color: #fff;
        }

        body.light .card,
        body.light .stat-card,
        body.light .championship-card {
            background: #fff;
            color: #111;
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.1);
        }

        body.light input,
        body.light select {
            background: #eee;
            color: #111;
        }

        body.light table th {
            background: #ff4d4d;
            color: #fff;
        }

        body.light tr:nth-child(even) {
            background: #f0f0f0;
        }

        body.light tr:hover {
            background: #ffe6e6;
        }

        /* ======================== MOBILE LAYOUT ======================== */
        /* ======================== MOBILE FULL RESPONSIVE ======================== */
        @media (max-width: 900px) {

            body {
                flex-direction: column;
                overflow: auto;
                /* importante para scroll */
            }

            /* MAIN ocupa tudo */
            .main {
                padding: 20px;
                padding-bottom: 100px;
                /* espa√ßo para bottom bar */
            }

            /* SIDEBAR vira bottom bar */
            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 75px;
                flex-direction: row;
                justify-content: space-around;
                align-items: center;
                padding: 0 10px;
                z-index: 1000;
                border-top: 1px solid #222;
            }

            /* Esconde logo */
            .sidebar .logo {
                display: none;
            }

            /* Bot√µes ficam s√≥ √≠cones */
            .sidebar button {
                flex-direction: column;
                justify-content: center;
                align-items: center;
                font-size: 0;
                /* esconde texto */
                gap: 5px;
                padding: 8px;
                margin: 0;
                border-left: none;
            }

            .sidebar button i {
                font-size: 20px;
            }

            .sidebar button.active {
                color: #ff0000;
                background: none;
                border: none;
            }

            .sidebar button:hover {
                background: none;
                border: none;
            }

            /* Esconde user box da sidebar */
            .sidebar-user {
                display: none;
            }

            /* FOTO FLUTUANTE */
            .mobile-user-photo {
                position: fixed;
                right: 15px;
                bottom: 95px;
                width: 58px;
                height: 58px;
                border-radius: 50%;
                object-fit: cover;
                border: 3px solid #ff0000;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
                z-index: 1100;
                cursor: pointer;
                transition: transform 0.2s ease;
                background: #111;
            }

            .mobile-user-photo:active {
                transform: scale(0.92);
            }

            /* Ajustes extras para tabelas no mobile */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            /* Cards menos espa√ßados */
            .card {
                padding: 18px;
            }

            .stats-grid,
            .championship-grid,
            .players-grid {
                gap: 15px;
            }
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .admin-header h1 {
            font-size: 28px;
            color: #ff4d4d;
        }

        .admin-header button.primary {
            padding: 10px 18px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
        }

        /* EVENTOS */
        /* Modal de cria√ß√£o de evento */
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .form-modal-content {
            background: #1e1e2f;
            padding: 25px;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-modal-content h2 {
            margin-bottom: 10px;
            color: #ff4d4d;
        }

        .form-modal-content input,
        .form-modal-content textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: #111;
            color: #fff;
            resize: none;
        }

        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .eventos-section {
            margin-bottom: 30px;
        }

        .eventos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .evento-card {
            background: #1e1e2f;
            border-radius: 14px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all 0.25s ease;
            overflow: hidden;
            /* importante */
        }

        .evento-card:hover {
            background: #151520;
            transform: translateY(-4px);
        }

        /* IMAGEM QUADRADA */
        .evento-img {
            width: 20%;
            aspect-ratio: 1 / 1;
            /* üî• deixa sempre quadrado */
            object-fit: cover;
            border-radius: 12px;
            display: block;
        }

        /* T√≠tulo */
        .evento-card h3 {
            color: #ff4d4d;
            font-size: 18px;
            margin: 0;
        }

        /* Descri√ß√£o */
        .evento-card p {
            color: #ccc;
            font-size: 14px;
            margin: 0;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .card-actions button {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }

        .card-actions .ativar-btn {
            background: #3498db;
            color: #fff;
        }

        .card-actions .terminar-btn {
            background: #2ecc71;
            color: #fff;
        }

        .card-actions .apagar-btn {
            background: #e74c3c;
            color: #fff;
        }

        /* ----------------- EVENTOS VIS√ÉO DO PLAYER ----------------- */
        .evento-card-ativo:hover {
            background: #151520;
        }

        /* IMAGEM */
        .evento-img-ativo img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }


        /* HEADER */
        .evento-header-ativo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 18px 5px 18px;
        }

        .evento-header-ativo h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }


        /* BADGE IMPORTANTE */
        .badge-importante-ativo {
            background: linear-gradient(135deg, #ff3b3b, #ff0000);
            color: #fff;
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            letter-spacing: 0.5px;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.6);
        }


        /* BODY */
        .evento-body-ativo {
            padding: 10px 18px 15px 18px;
            font-size: 14px;
            color: #d1d1e0;
        }

        .evento-body-ativo p {
            margin: 6px 0;
        }

        .evento-body-ativo strong {
            color: #ffffff;
        }


        /* FOOTER */
        .evento-footer-ativo {
            margin-top: auto;
            padding: 15px 18px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: flex-end;
        }

        .discord-btn {
            background: #5865F2;
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: 0.3s ease;
        }

        .discord-btn:hover {
            background: #4752c4;
            transform: scale(1.05);
        }
        /* Participar modal styles */
        #participarModal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.6);
            z-index: 4000;
        }

        #participarModal .modal-content {
            width: 480px;
            max-width: calc(100% - 40px);
            background: #0f1115;
            padding: 18px;
            border-radius: 10px;
            color: #e6eef6;
            box-shadow: 0 8px 30px rgba(0,0,0,0.7);
        }

        #participarModal .modal-content h3 { margin-bottom: 8px; color:#ff4d4d; }
        #participarModal .modal-row { margin:8px 0; }
        #participarModal input, #participarModal textarea, #participarModal select {
            width:100%; padding:8px 10px; border-radius:8px; border:none; background:#0d1114; color:#e6eef6;
        }
        #participarModal .modal-actions { display:flex; justify-content:flex-end; gap:8px; margin-top:12px; }
        .login-top-btn {
            position: fixed;
            top: 16px;
            right: 18px;
            z-index: 2000;
            background: #ff4d4d;
            color: #fff;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 77, 77, 0.25);
        }

        .login-top-btn:hover { filter: brightness(0.95); }
        /* Settings modal (estilo Discord) */
        .settings-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .settings-modal {
            width: 900px;
            max-width: calc(100% - 40px);
            height: 560px;
            background: linear-gradient(180deg,#0f1115,#0b0c0f);
            border-radius: 12px;
            display: flex;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(2,6,23,0.8);
            color: #e6eef6;
        }

        .settings-sidebar {
            width: 220px;
            background: linear-gradient(180deg,#0b0d11,#0a0b0d);
            padding: 14px;
            box-sizing: border-box;
            border-right: 1px solid rgba(255,255,255,0.03);
        }

        .settings-sidebar ul { list-style:none; padding:0; margin:0; }
        .settings-sidebar li { padding:10px 12px; border-radius:8px; cursor:pointer; margin-bottom:8px; color:#bcd3ee; }
        .settings-sidebar li.active { background: rgba(255,255,255,0.03); color:#fff; }

        .settings-content { flex:1; padding:20px 22px; overflow:auto; }
        .settings-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .settings-title { font-size:18px; font-weight:700; color:#fff; }
        .settings-close { background:none; border:none; color:#9fb6d9; font-size:18px; cursor:pointer; }

        .settings-row { margin:12px 0; }
        .settings-label { display:block; color:#b6cbe6; margin-bottom:8px; font-size:13px; }
        .settings-input, .settings-select { width:100%; padding:10px 12px; border-radius:8px; border:none; background:#0d1114; color:#e6eef6; }

        .settings-actions { display:flex; justify-content:flex-end; gap:8px; margin-top:12px; }
        .btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#cfe3ff; padding:8px 12px; border-radius:8px; cursor:pointer; }
        .btn-primary { background:#5865F2; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
    </style>
</head>

<body>
    <button id="btnEntrarTop" class="login-top-btn" style="display:none">Entrar</button>
    <!-- Settings Modal -->
    <div id="settingsModalOverlay" class="settings-modal-overlay" aria-hidden="true">
        <div class="settings-modal" role="dialog" aria-modal="true">
            <div class="settings-sidebar">
                <ul>
                    <li data-section="profile" class="active">Perfil</li>
                    <li data-section="appearance">Apar√™ncia</li>
                    <li data-section="account">Conta</li>
                </ul>
            </div>
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">Configura√ß√µes</div>
                    <button id="settingsClose" class="settings-close">‚úï</button>
                </div>

                <div id="settingsProfile" class="settings-panel">
                    <div class="settings-row">
                        <label class="settings-label">Nome</label>
                        <input id="settingsNome" class="settings-input" type="text">
                    </div>
                    <div class="settings-row">
                        <label class="settings-label">Foto de Perfil</label>
                        <input id="settingsFoto" class="settings-input" type="file" accept="image/*">
                        <div style="margin-top:8px;"><img id="settingsFotoPreview" src="" style="width:72px;height:72px;border-radius:10px;object-fit:cover;display:none;border:2px solid rgba(255,255,255,0.06);"></div>
                    </div>
                </div>

                <div id="settingsAppearance" class="settings-panel" style="display:none;">
                    <div class="settings-row">
                        <label class="settings-label">Tema</label>
                        <select id="settingsTema" class="settings-select">
                            <option value="dark">üåô Escuro</option>
                            <option value="light">‚òÄÔ∏è Claro</option>
                        </select>
                    </div>
                </div>

                <div id="settingsAccount" class="settings-panel" style="display:none;">
                    <p style="color:#b6cbe6">Gerir conta e prefer√™ncias.</p>
                </div>

                <div class="settings-actions">
                    <button id="settingsCancel" class="btn-ghost">Cancelar</button>
                    <button id="settingsSave" class="btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar">
        <img src="logo.webp" class="logo" alt="Logo MK">
        <button id="btnDashboard"><i class="fa-solid fa-home"></i> Dashboard</button>
        <button id="btnEventos"><i class="fa-solid fa-ticket"></i> Eventos</button>
        <button id="btnAdmin" style="display:none;"><i class="fa-solid fa-user-shield"></i> Painel
            Administra√ß√£o</button>

        <div class="sidebar-user" id="sidebarUserBox">
            <div class="user-info" style="display:flex; align-items:center; gap:12px;">
                <img id="userPhoto" src="https://i.imgur.com/4Z7Dz7S.png"
                    style="width:52px; height:52px; border-radius:50%; object-fit:cover; border:2px solid #ff4d4d;">

                <div class="user-text" style="display:flex; flex-direction:column; min-width:0;">
                    <strong id="userNomeSidebar" style="font-size:14px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Carregando..</strong>
                    <span id="userIdSidebar" style="font-size:12px; color:#aaa; margin-top:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Carregando..</span>
                    <span id="userCargoSidebar" class="badgeCargo badgeUser" style="font-size:0.75em; margin-top:6px; display:inline-block; padding:4px 8px;">Carregando..</span>
                </div>
            </div>

            <div class="user-actions">
                <button id="btnSettings"><i class="fa-solid fa-gear"></i></button>
                <button id="btnLogoutIcon"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </div>
    </div>

    <div class="main" id="mainContent"></div>
    <img id="mobileUserPhoto" class="mobile-user-photo" style="display:none;">

    <!-- Participar Modal -->
    <div id="participarModal">
        <div class="modal-content" role="dialog" aria-modal="true">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <h3>Participar no Evento</h3>
                <button id="closeModal" style="background:none;border:none;color:#cfe3ff;font-size:18px;cursor:pointer">‚úï</button>
            </div>
            <form id="participarForm">
                <div class="modal-row">
                    <label class="settings-label">Id (in game):</label>
                    <input id="playerId" placeholder="Seu Id dentro do jogo" />
                </div>
                <div class="modal-row">
                    <label class="settings-label">Id (discord):</label>
                    <input id="discordId" placeholder="Seu Id do Discord (ex: 123456789012345678)" />
                </div>
                <div id="teamFields" style="display:none">
                    <div class="modal-row">
                        <label class="settings-label">Quantidade de membros:</label>
                        <input id="teamCount" type="number" min="1" value="1" />
                    </div>
                    <div class="modal-row">
                        <label class="settings-label">Id's dos participantes (separados por v√≠rgula):</label>
                        <textarea id="participantsIds" rows="3" placeholder="id1,id2,id3"></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" id="cancelParticipar" class="btn-ghost">Cancelar</button>
                    <button type="submit" id="submitParticipar" class="btn-primary">Enviar</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { db, auth } from "./firebase.js";
        import {
            collection, getDocs, getDoc, addDoc, deleteDoc,
            doc, updateDoc, setDoc, query, where
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let currentUser = null, currentUserNome = null, currentUserId = null, currentUserRole = null;
        let jogadores = [], grafico = null;

        // ---------------- FUN√á√ïES AUXILIARES ----------------
        function ativarBotao(id) {
            document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
            document.getElementById(id).classList.add("active");
        }

        async function logout() {
            try {
                if (auth && auth.currentUser) await signOut(auth);
            } catch (e) {
                console.error(e);
            }
            window.location.href = "dashboard.html";
        }

        // ---------------- SE√á√ïES ----------------
        async function mostrarSecao(secao) {
            const main = document.getElementById("mainContent");
            const cargoMap = {
                ceo: { emoji: "üëë", classe: "badgeCEO" },
                admin: { emoji: "üõ°Ô∏è", classe: "badgeAdmin" },
                moderador: { emoji: "‚öîÔ∏è", classe: "badgeModerador" },
                user: { emoji: "üë§", classe: "badgeUser" }
            };

            const cargo = currentUserRole ? currentUserRole.toLowerCase() : "user";
            const cargoInfo = cargoMap[cargo] || cargoMap.user;
            jogadores = [];

            switch (secao) {
                case "Dashboard":
                    ativarBotao("btnDashboard");
                    main.innerHTML = `
                    <header class="dashboard-header" style="padding:15px 0;">
                        <h2 style="margin:0; font-weight:600;">Dashboard</h2>
                    </header>

                    <!-- Cards Estat√≠sticas -->
                    <section class="stats-grid">

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fa-solid fa-user-shield"></i></div>
                            <div>
                                <h3 id="totalStaff">0</h3>
                                <p>Total de Staff</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fa-solid fa-bolt"></i></div>
                            <div>
                                <h3 id="totalEventosAtivos">0</h3>
                                <p>Eventos Ativos</p>
                            </div>
                        </div>

                    </section>

                    <!-- Eventos Ativos -->
                    <section class="eventos-section">
                        <h3 class="section-title">
                            <i class="fa-solid fa-bolt"></i> Eventos Ativos
                        </h3>
                        <div id="eventosContainer" class="eventos-grid"></div>
                    </section>
                `;

                    setTimeout(() => carregarDashboard(), 0);
                    break;

                case "Eventos":
                    ativarBotao("btnEventos");

                    main.innerHTML = `
                        <section class="eventos-section">
                            <h3 class="section-title">
                                <i class="fa-solid fa-bolt"></i> Eventos Ativos
                            </h3>

                            <div id="eventosAtivosContainer" class="eventos-grid">
                                <p>A carregar eventos...</p>
                            </div>
                        </section>
                    `;

                    setTimeout(() => carregarEventosAtivos(), 0);
                    break;

                case "Admin":
                    ativarBotao("btnAdmin");

                    main.innerHTML = `
                    <div class="admin-dashboard">

                        <!-- SIDEBAR -->
                        <aside class="admin-sidebar">
                            <h2 class="admin-brand">
                                <img src="logo.webp" alt="Logo MK"
                                    style="
                                        height:42px;
                                        width:auto;
                                        margin-right:12px;
                                        border-radius:12px;
                                        padding:6px;
                                        background:linear-gradient(135deg,#ff4d4d,#ff1a1a);
                                        box-shadow:0 0 15px rgba(255,77,77,0.6);
                                        transition:0.3s ease;
                                    "
                                    onmouseover="this.style.transform='scale(1.08)'"
                                    onmouseout="this.style.transform='scale(1)'"
                                >
                                <span style="
                                    font-weight:600;
                                    letter-spacing:1px;
                                    background:linear-gradient(90deg,#ff4d4d,#ffffff);
                                    -webkit-background-clip:text;
                                    -webkit-text-fill-color:transparent;
                                ">
                                    MK Admin
                                </span>
                            </h2>
                            <ul id="adminMenu">
                                <li class="active" data-section="dashboard"><i class="fa-solid fa-home"></i> Dashboard</li>
                                <li data-section="eventos"><i class="fa-solid fa-ticket"></i> Eventos</li>
                                <li data-section="inscricoes"><i class="fa-solid fa-list-check"></i> Inscri√ß√µes</li>
                                <li data-section="utilizadores"><i class="fa-solid fa-user-shield"></i> Utilizadores</li>
                                <li data-section="configuracoes"><i class="fa-solid fa-gear"></i> Configura√ß√µes</li>
                            </ul>
                        </aside>

                        <div class="admin-content">
                            <div id="adminDynamicContent"></div>
                        </div>
                    </div>
                    `;

                    // Inicializar menu lateral AP√ìS renderizar o HTML
                    configurarMenuAdmin();

                    // Carregar sub-se√ß√£o inicial do Admin
                    carregarSecao("dashboard");
                    break;
            }
        }

        // ---------------- DASHBOARD ----------------
        async function carregarDashboard() {
            try {

                // üîπ Buscar apenas Staff (ceo, admin, moderador)
                const staffQuery = query(
                    collection(db, "admins"), // ou "users" se for essa a cole√ß√£o
                    where("cargo", "in", ["ceo", "admin", "moderador"])
                );

                const staffSnap = await getDocs(staffQuery);

                const totalStaffEl = document.getElementById("totalStaff");
                if (totalStaffEl) totalStaffEl.innerText = staffSnap.size;

                // üîπ Buscar Eventos Ativos
                const eventosSnap = await getDocs(collection(db, "eventosAtivos"));

                const totalEventosEl = document.getElementById("totalEventosAtivos");
                if (totalEventosEl) totalEventosEl.innerText = eventosSnap.size;


                // üîπ Container da lista de eventos
                const container = document.getElementById("eventosContainer");
                if (!container) return;

                container.innerHTML = "";

                if (eventosSnap.empty) {
                    container.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-circle-info"></i>
                    <p>Nenhum evento ativo no momento.</p>
                </div>
            `;
                    return;
                }

                // üî• Criar cards dos eventos
                eventosSnap.forEach(docSnap => {
                    const data = docSnap.data();
                    const id = docSnap.id;

                    const card = document.createElement("div");
                    card.classList.add("evento-card");

                    card.innerHTML = `
                <div class="evento-header">
                    <i class="fa-solid fa-bolt"></i>
                    <span>${data.nome || "Evento"}</span>
                </div>

                <div class="evento-body">
                    <small>Descri√ß√£o: ${data.descricao || "-"}</small><br>
                    <small>In√≠cio: ${data.inicio || "-"}</small>
                </div>
            `;

                    // Bot√£o terminar evento
                    const btn = card.querySelector("button");
                    if (btn) {
                        btn.onclick = async () => {

                            const eventoDoc = doc(db, "eventosAtivos", id);
                            const eventoSnap = await getDoc(eventoDoc);

                            if (eventoSnap.exists()) {
                                const eventoData = eventoSnap.data();

                                // Move para eventosDisponiveis
                                await setDoc(doc(db, "eventosDisponiveis", id), eventoData);

                                // Remove de ativos
                                await deleteDoc(eventoDoc);

                                carregarDashboard();
                            }
                        };
                    }

                    container.appendChild(card);
                });

            } catch (e) {
                console.error("Erro ao carregar dashboard:", e);
            }
        }

        let eventoSelecionadoId = null;

        // ------------------ Carregar Eventos Ativos ------------------
        export async function carregarEventosAtivos() {
            console.log("[DEBUG] Iniciando carregarEventosAtivos");

            const container = document.getElementById("eventosAtivosContainer");
            if (!container) {
                console.error("[DEBUG] Container de eventos n√£o encontrado!");
                return;
            }

            container.innerHTML = "";

            try {
                const snapshot = await getDocs(collection(db, "eventosAtivos"));
                console.log("[DEBUG] Snapshot eventosAtivos obtido:", snapshot.size);

                if (snapshot.empty) {
                    container.innerHTML = "<p>Nenhum evento ativo no momento.</p>";
                    return;
                }

                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    const id = docSnap.id;

                    const card = document.createElement("div");
                    card.classList.add("evento-card-ativo");

                    card.innerHTML = `
                ${data.imagem ? `
                    <div class="evento-img-ativo">
                        <img src="${data.imagem}" alt="${data.nome}" />
                    </div>
                ` : ""}

                <div class="evento-header-ativo">
                    <h4>${data.nome || "Evento Sem Nome"}</h4>
                    ${data.importante ? `<span class="badge-importante-ativo">IMPORTANTE</span>` : ""}
                </div>

                <div class="evento-body-ativo">
                    <p><strong>Descri√ß√£o:</strong> ${data.descricao || "-"}</p>
                    <p><strong>In√≠cio:</strong> ${data.inicio || "-"}</p>
                    <p><strong>Local:</strong> ${data.local || "-"}</p>
                    <p><strong>Recompensa:</strong> ${data.recompensa || "-"}</p>
                    <p><strong>Regras:</strong> ${data.regras || "-"}</p>
                </div>

                <div class="evento-footer-ativo">
                    <button class="discord-btn" data-id="${id}">
                        <i class="fa-solid fa-right-from-bracket"></i> Participar no Evento
                    </button>
                </div>
            `;

                    container.appendChild(card);
                });

                // ------------------ Bot√£o Terminar Evento ------------------
                container.querySelectorAll(".terminar-btn").forEach(btn => {
                    btn.addEventListener("click", async e => {
                        const id = e.currentTarget.dataset.id;
                        console.log("[DEBUG] Terminar evento clicado:", id);

                        const eventoDoc = doc(db, "eventosAtivos", id);
                        const eventoSnap = await getDoc(eventoDoc);

                        if (!eventoSnap.exists()) {
                            console.warn("[DEBUG] Evento n√£o encontrado no Firestore:", id);
                            return;
                        }

                        const eventoData = eventoSnap.data();

                        // Mover para eventosDisponiveis
                        await setDoc(doc(db, "eventosDisponiveis", id), eventoData);
                        await deleteDoc(eventoDoc);

                        console.log("[DEBUG] Evento movido para eventosDisponiveis:", id);

                        carregarEventosAtivos();
                    });
                });

            } catch (err) {
                console.error("[DEBUG] Erro ao carregar eventos:", err);
                container.innerHTML = "<p>Erro ao carregar eventos.</p>";
            }
        }

        // ------------------ Modal Participar no Evento ------------------
        /*
           inicializarModalDiscord()
           - Centraliza toda a l√≥gica de intera√ß√£o com o modal de participa√ß√£o
           - Abre modal quando um bot√£o `.discord-btn` √© clicado
           - Busca dados do evento para decidir se √© modo equipe
           - Valida e envia os dados para o Discord via webhook
        */
        export function inicializarModalDiscord() {
            console.log("[DEBUG] Inicializando modal Discord");

            // Elementos do modal
            const modal = document.getElementById("participarModal");
            const closeModal = document.getElementById("closeModal");
            const form = document.getElementById("participarForm");
            const teamFields = document.getElementById("teamFields");
            const teamCount = document.getElementById("teamCount");
            const participantsIds = document.getElementById("participantsIds");
            const cancelParticipar = document.getElementById("cancelParticipar");

            if (!modal || !closeModal || !form) {
                console.error("[DEBUG] Modal, close ou form n√£o encontrado!");
                return;
            }

            // ---------- Abrir modal ----------
            // Delegation: escuta cliques no documento para qualquer bot√£o `.discord-btn`
            document.addEventListener("click", async (e) => {
                const btn = e.target.closest(".discord-btn");
                if (!btn) return;

                eventoSelecionadoId = btn.dataset.id;
                console.log("[DEBUG] Bot√£o Participar clicado - eventoSelecionadoId:", eventoSelecionadoId);

                // Buscar dados do evento para decidir se mostramos campos de equipe
                try {
                    const eventoRef = doc(db, "eventosAtivos", eventoSelecionadoId);
                    const eventoSnap = await getDoc(eventoRef);
                    if (!eventoSnap.exists()) {
                        console.warn("[DEBUG] Evento n√£o encontrado para participar:", eventoSelecionadoId);
                        Swal.fire({ icon: 'error', title: 'Erro', text: 'Evento n√£o encontrado.' });
                        return;
                    }

                    const eventoData = eventoSnap.data();

                    // Detectar se √© evento em equipa: checar campos comuns
                    const formato = eventoData.formato || eventoData.teamSize || 1;
                    const tipo = (eventoData.tipo || "").toString().toLowerCase();
                    const isTeam = (formato && formato > 1) || tipo.includes('team') || tipo.includes('equipe');

                    if (isTeam) {
                        teamFields.style.display = 'block';
                        teamCount.value = formato > 1 ? formato : 2;
                        participantsIds.placeholder = 'id1,id2,... (al√©m do l√≠der)';
                    } else {
                        teamFields.style.display = 'none';
                        teamCount.value = 1;
                        participantsIds.value = '';
                    }

                    // Exibir modal
                    modal.style.display = "flex";
                } catch (err) {
                    console.error('[DEBUG] Erro ao buscar evento para modal:', err);
                    Swal.fire({ icon: 'error', title: 'Erro', text: 'N√£o foi poss√≠vel abrir o modal. Veja o console.' });
                }
            });

            // ---------- Fechar modal ----------
            closeModal.onclick = () => { modal.style.display = "none"; };
            if (cancelParticipar) cancelParticipar.onclick = () => { modal.style.display = "none"; };
            window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

            // ---------- Submeter formul√°rio ----------
            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                // Valores do formul√°rio
                const playerId = document.getElementById("playerId").value.trim();
                const discordId = document.getElementById("discordId").value.trim();
                const teamCountVal = parseInt(teamCount.value) || 1;
                const participantsRaw = participantsIds.value.trim();

                // Valida√ß√µes b√°sicas
                if (!playerId || !discordId) {
                    Swal.fire({ icon: 'warning', title: 'Campos vazios', text: 'Preencha Id (in game) e Id (discord).' });
                    return;
                }

                try {
                    const eventoRef = doc(db, "eventosAtivos", eventoSelecionadoId);
                    const eventoSnap = await getDoc(eventoRef);
                    if (!eventoSnap.exists()) {
                        Swal.fire({ icon: 'error', title: 'Erro', text: 'Evento n√£o encontrado.' });
                        return;
                    }

                    const eventoData = eventoSnap.data();

                    // Construir lista de participantes (array)
                    const participantsList = participantsRaw ? participantsRaw.split(',').map(s => s.trim()).filter(Boolean) : [];

                    // Payload padr√£o com metadados √∫teis
                    const dadosParaDiscord = {
                        eventId: eventoSelecionadoId,
                        eventName: eventoData.nome || '',
                        playerId,
                        discordId,
                        teamCount: teamCountVal,
                        participants: participantsList,
                        eventoData
                    };

                    // Envia para o webhook (fun√ß√£o abaixo)
                    const resultado = await enviarEventoDiscord(dadosParaDiscord);
                    if (resultado && resultado.ok) {
                        Swal.fire({ icon: 'success', title: 'Enviado', text: 'Participa√ß√£o enviada com sucesso para o Discord!' });
                    } else {
                        Swal.fire({ icon: 'error', title: 'Erro', text: 'Falha ao enviar. Veja o console.' });
                    }

                    // Salvar inscri√ß√£o no Firestore para relat√≥rio (collection: incricoes)
                    try {
                        await addDoc(collection(db, 'incricoes'), {
                            eventId: eventoSelecionadoId,
                            eventName: eventoData.nome || '',
                            playerId,
                            discordId,
                            teamCount: teamCountVal,
                            participants: participantsList,
                            timestamp: new Date()
                        });
                    } catch (errSave) {
                        console.error('Erro ao salvar inscri√ß√£o no Firestore:', errSave);
                    }

                    // Reset e fechar
                    form.reset();
                    teamFields.style.display = 'none';
                    modal.style.display = "none";
                } catch (err) {
                    console.error('[DEBUG] Erro no submit participa√ß√£o:', err);
                    Swal.fire({ icon: 'error', title: 'Erro', text: 'Erro ao processar a participa√ß√£o.' });
                }
            });
        }

        // ------------------ Inicializar ------------------
        document.addEventListener("DOMContentLoaded", () => {
            console.log("[DEBUG] DOM carregado");
            carregarEventosAtivos();
            inicializarModalDiscord();
        });


        // ------------------ Enviar para Discord via Webhook (mensagem bonita com embed) ------------------
        /*
           A fun√ß√£o monta um objeto de webhook contendo:
             - `content`: menciona o usu√°rio via <@id> para notifica√ß√£o
             - `embeds`: informa√ß√µes detalhadas do evento em campos organizados
           Observa√ß√£o: navegadores podem bloquear requisi√ß√µes diretas por CORS.
        */
        async function enviarEventoDiscord(payload) {
            try {
                const webhookUrl = "https://discord.com/api/webhooks/1473842925694750801/BPgcb4hLdBG0PD41DLa_fS6HE0BnNZvkpXWMgNhkAwC7cGpRqumeNfCvXIqbsDX31do4";

                // Monta o texto de men√ß√£o (para realmente notificar o usu√°rio no Discord)
                const mention = `<@${payload.discordId}>`;

                // Preparar campos do embed
                const fields = [];
                fields.push({ name: 'Evento ID', value: String(payload.eventId || '‚Äî'), inline: true });
                fields.push({ name: 'Nome do Evento', value: payload.eventName || (payload.eventoData?.nome || '‚Äî'), inline: true });
                fields.push({ name: 'Player (in-game)', value: payload.playerId || '‚Äî', inline: true });
                fields.push({ name: 'Discord', value: mention || '‚Äî', inline: true });

                // Informa√ß√µes adicionais do evento
                if (payload.eventoData) {
                    if (payload.eventoData.inicio) fields.push({ name: 'In√≠cio', value: String(payload.eventoData.inicio), inline: true });
                    if (payload.eventoData.local) fields.push({ name: 'Local', value: String(payload.eventoData.local), inline: true });
                    if (payload.eventoData.recompensa) fields.push({ name: 'Recompensa', value: String(payload.eventoData.recompensa), inline: true });
                }

                // Team info
                if (payload.teamCount && payload.teamCount > 1) {
                    fields.push({ name: 'Tipo', value: `Equipa ‚Äî ${payload.teamCount} membros`, inline: true });
                    if (payload.participants && payload.participants.length) {
                        // limitar tamanho do campo para evitar ultrapassar limites do embed
                        const participantsText = payload.participants.join(', ');
                        fields.push({ name: 'Membros', value: participantsText.substring(0, 1024) || '‚Äî', inline: false });
                    }
                }

                // Construir embed bonito
                const embed = {
                    title: `Nova inscri√ß√£o: ${payload.eventName || 'Evento'}`,
                    description: `Um novo jogador inscreveu-se neste evento.`,
                    color: 0x5865F2, // cor Discord-like
                    fields,
                    timestamp: new Date().toISOString(),
                    footer: { text: 'MK - Inscri√ß√µes', icon_url: '' }
                };

                const body = {
                    // menciona o usu√°rio para garantir notifica√ß√£o
                    content: `${mention} Inscri√ß√£o recebida ‚úÖ`,
                    embeds: [embed]
                };

                // Envio via fetch
                const res = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!res.ok) {
                    const text = await res.text();
                    throw new Error(`Discord webhook error: ${res.status} ${text}`);
                }

                return { ok: true };
            } catch (err) {
                console.error('Erro ao enviar webhook:', err);
                return { ok: false, error: err };
            }
        }

        // ------------------
        // Carregar Chaves
        // ------------------
        async function carregarChaves() {
            const container = document.getElementById("chavesContainer");
            container.innerHTML = "";
            try {
                const snap = await getDocs(collection(db, "chaves"));
                if (snap.empty) {
                    container.innerHTML = "<p>Nenhuma chave gerada ainda.</p>";
                    return;
                }

                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    const div = document.createElement("div");
                    div.classList.add("team-box");
                    div.style.flex = "1 1 200px";
                    div.style.display = "flex";
                    div.style.flexDirection = "column";
                    div.style.justifyContent = "space-between";

                    const titulo = document.createElement("strong");
                    titulo.textContent = `Chave: ${data.chave}`;

                    const info = document.createElement("small");
                    info.innerHTML = `
                        Tipo: ${data.tipo || "N√£o definido"}<br>
                        Local: ${data.local || "N√£o definido"}<br>
                        Arma: ${data.arma || "N√£o definido"}
                    `;
                    info.style.marginTop = "5px";

                    const btnContainer = document.createElement("div");
                    btnContainer.style.marginTop = "10px";
                    btnContainer.style.display = "flex";
                    btnContainer.style.gap = "5px";

                    const btnAbrir = document.createElement("button");
                    btnAbrir.classList.add("primary");
                    btnAbrir.innerHTML = '<i class="fa-solid fa-trophy"></i> Abrir Campeonato';
                    btnAbrir.addEventListener("click", () => {
                        window.location.href = `campeonato.html?chave=${data.chave}`;
                    });

                    const btnDeletar = document.createElement("button");
                    btnDeletar.classList.add("delete-btn");
                    btnDeletar.innerHTML = '<i class="fa-solid fa-trash"></i>';
                    btnDeletar.addEventListener("click", () => deletarChave(docSnap.id));

                    btnContainer.appendChild(btnAbrir);
                    btnContainer.appendChild(btnDeletar);

                    div.appendChild(titulo);
                    div.appendChild(btnContainer);
                    container.appendChild(div);
                });
            } catch (e) {
                console.error(e);
                container.innerHTML = "<p>Erro ao carregar chaves.</p>";
            }
        }

        // ------------------
        // Gerar Token
        // ------------------
        function gerarToken(length) {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            let token = "";
            for (let i = 0; i < length; i++) token += chars.charAt(Math.floor(Math.random() * chars.length));
            return token;
        }

        // ------------------
        // Deletar Chave Bot√£o
        // ------------------
        async function deletarChave(docId) {
            const confirm = await Swal.fire({
                icon: "warning",
                title: "Tem certeza?",
                text: "Esta chave ser√° deletada!",
                showCancelButton: true,
                confirmButtonText: "Sim, deletar",
                cancelButtonText: "Cancelar"
            });
            if (confirm.isConfirmed) {
                try {
                    await deleteDoc(doc(db, "chaves", docId));
                    Swal.fire({ icon: "success", title: "Chave deletada!" });
                    carregarChaves();
                } catch (e) {
                    console.error(e);
                    Swal.fire({ icon: "error", title: "Erro ao deletar chave" });
                }
            }
        }

        // ------------------
        // Gerar Chave
        // ------------------
        async function gerarChave() {
            const { value: formValues } = await Swal.fire({
                title: "Criar Novo Campeonato",
                html: `
                    <label style="display:block;margin-bottom:5px;">Tipo:</label>
                    <select id="swalTipo" class="swal2-select">
                        <option value="1v1">1v1</option>
                        <option value="2v2">2v2</option>
                        <option value="3v3">3v3</option>
                        <option value="4v4">4v4</option>
                        <option value="5v5">5v5</option>
                        <option value="6v6">6v6</option>
                    </select>

                    <label style="display:block;margin:15px 0 5px;">Local:</label>
                    <select id="swalLocal" class="swal2-select">
                        <option value="Fazenda">Fazenda</option>
                        <option value="Pr√©dio">Pr√©dio</option>
                        <option value="Porta-Avi√µes">Porta-Avi√µes</option>
                        <option value="Labirinto">Labirinto</option>
                        <option value="Porto">Porto</option>
                        <option value="Prefeitura">Prefeitura</option>
                        <option value="Pris√£o">Pris√£o</option>
                        <option value="Antena">Antena</option>
                    </select>

                    <label style="display:block;margin:15px 0 5px;">Arma:</label>
                    <select id="swalArma" class="swal2-select">
                        <option value="Five-Seven">Five-Seven</option>
                        <option value="G36">G36</option>
                    </select>
                `,
                showCancelButton: true,
                confirmButtonText: "Gerar Campeonato",
                cancelButtonText: "Cancelar",
                preConfirm: () => {
                    return {
                        tipo: document.getElementById("swalTipo").value,
                        local: document.getElementById("swalLocal").value,
                        arma: document.getElementById("swalArma").value
                    };
                }
            });

            if (!formValues) return;

            try {
                // üî• BUSCAR TODAS AS EQUIPAS
                const equipasSnap = await getDocs(collection(db, "equipas"));

                if (equipasSnap.empty) {
                    Swal.fire({ icon: "warning", title: "N√£o existem equipas criadas!" });
                    return;
                }

                let listaEquipas = [];

                equipasSnap.forEach(docSnap => {
                    const data = docSnap.data();
                    listaEquipas.push({
                        id: docSnap.id,
                        nome: "Equipa " + docSnap.id.slice(0, 4),
                        jogadores: data.equipa || []
                    });
                });

                const chave = gerarToken(8);

                // üî• SALVAR CHAVE COM EQUIPAS
                await addDoc(collection(db, "chaves"), {
                    chave: chave,
                    tipo: formValues.tipo,
                    local: formValues.local,
                    arma: formValues.arma,
                    criadoEm: new Date(),
                    criadoPor: currentUser.email,
                    equipas: listaEquipas // üëà AQUI EST√Å O SEGREDO
                });

                Swal.fire({
                    icon: "success",
                    title: "Campeonato criado com sucesso!",
                    html: `
                <b>Chave:</b> ${chave}<br>
                <b>Equipas:</b> ${listaEquipas.length}
            `
                });

                carregarChaves();
                carregarDashboard();

            } catch (e) {
                console.error(e);
                Swal.fire({ icon: "error", title: "Erro ao criar campeonato" });
            }
        }

        // ---------------- EQUIPES ----------------
        async function adicionarJogador() {
            const idInput = document.getElementById("jogadorIdInput");
            const nomeInput = document.getElementById("jogadorNomeInput");
            const id = idInput.value.trim();
            const nome = nomeInput.value.trim();

            if (!id || !nome) {
                Swal.fire({ icon: "warning", title: "Erro", text: "Preencha o ID e o Nome do jogador", timer: 1500, showConfirmButton: false });
                return;
            }

            if (jogadores.some(j => j.id === id)) {
                Swal.fire({ icon: "error", title: "Erro", text: "ID j√° adicionado!", timer: 1500, showConfirmButton: false });
                return;
            }

            // Adiciona ao array local
            jogadores.push({ id, nome });

            // Salva na tabela "jogadores" no Firestore
            try {
                await setDoc(doc(db, "jogadores", id), {
                    nome: nome,
                    criadoEm: new Date(),
                    criadoPor: currentUser.email
                });
            } catch (e) {
                console.error(e);
                Swal.fire({ icon: "error", title: "Erro ao salvar jogador" });
                return;
            }

            idInput.value = "";
            nomeInput.value = "";
            atualizarTabelaJogadores();
            Swal.fire({ icon: "success", title: "Jogador adicionado", timer: 1000, showConfirmButton: false });
        }

        // ------------------
        // Atualizar Tabela de Jogadores
        // ------------------
        async function atualizarTabelaJogadores() {
            const tbody = document.querySelector("#tabelaJogadores tbody");
            tbody.innerHTML = "";

            try {
                const snap = await getDocs(collection(db, "jogadores"));
                if (snap.empty) {
                    tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; font-style:italic;">Nenhum jogador adicionado ainda.</td></tr>`;
                    jogadores = [];
                    return;
                }

                jogadores = []; // limpa o array local
                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    jogadores.push({ id: docSnap.id, nome: data.nome });
                });

                jogadores.forEach(j => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                <td>${j.id}</td>
                <td>${j.nome}</td>
                <td>
                    <button class="delete-btn" style="padding:4px 8px; font-size:12px;">‚ùå Remover</button>
                </td>`;
                    tr.querySelector("button").onclick = async () => {
                        try {
                            await deleteDoc(doc(db, "jogadores", j.id));
                            Swal.fire({ icon: "success", title: "Jogador removido", timer: 1000, showConfirmButton: false });
                            atualizarTabelaJogadores(); // recarrega a tabela
                        } catch (e) {
                            console.error(e);
                            Swal.fire({ icon: "error", title: "Erro ao remover jogador" });
                        }
                    };
                    tbody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; color:red;">Erro ao carregar jogadores</td></tr>`;
            }
        }

        // ------------------
        // Gerar Bracket
        // ------------------
        function gerarBracket() {
            const container = document.getElementById("bracketContainer");
            container.innerHTML = "";

            if (!equipes || !equipes.length) {
                container.innerHTML = "<p>Nenhuma equipa neste campeonato.</p>";
                return;
            }

            // üî• Embaralhar equipas
            let faseAtual = [...equipes].sort(() => Math.random() - 0.5);

            let total = faseAtual.length;

            // üî• Ajustar para pot√™ncia de 2
            let tamanho = 1;
            while (tamanho < total) tamanho *= 2;

            // üî• Adicionar BYE se necess√°rio
            while (faseAtual.length < tamanho) {
                faseAtual.push({ nome: "BYE" });
            }

            let rounds = Math.log2(tamanho);

            for (let r = 0; r < rounds; r++) {

                const roundDiv = document.createElement("div");
                roundDiv.classList.add("round");

                const titulo = document.createElement("h3");

                titulo.innerText =
                    r === rounds - 1 ? "üèÜ Final" :
                        r === rounds - 2 ? "‚öîÔ∏è Semifinal" :
                            r === rounds - 3 ? "üî• Quartas" :
                                "Fase " + (r + 1);

                roundDiv.appendChild(titulo);

                for (let i = 0; i < faseAtual.length; i += 2) {

                    const match = document.createElement("div");
                    match.classList.add("match");

                    const teamA = document.createElement("div");
                    teamA.classList.add("team");
                    teamA.innerText = faseAtual[i]?.nome || "BYE";

                    const teamB = document.createElement("div");
                    teamB.classList.add("team");
                    teamB.innerText = faseAtual[i + 1]?.nome || "BYE";

                    match.appendChild(teamA);
                    match.appendChild(teamB);

                    roundDiv.appendChild(match);
                }

                container.appendChild(roundDiv);

                // üî• Preparar pr√≥xima fase
                faseAtual = new Array(faseAtual.length / 2)
                    .fill(null)
                    .map(() => ({ nome: "A definir" }));
            }
        }

        // ------------------
        // Carregar Equipes
        // ------------------
        async function carregarEquipas() {
            const chavesSnap = await getDocs(collection(db, "chaves"));
            let campeonato = null;

            chavesSnap.forEach(docSnap => {
                const d = docSnap.data();
                if (d.chave === chaveURL) campeonato = d;
            });

            if (!campeonato || !campeonato.equipas) {
                document.getElementById("bracketContainer").innerHTML =
                    "<p>Nenhuma equipa associada a este campeonato.</p>";
                return;
            }

            equipes = campeonato.equipas;
            gerarBracket();
        }

        // ------------------
        // Criar Equipe Bot√£o
        // ------------------
        async function criarEquipes() {
            const formato = parseInt(document.getElementById("formato").value);
            if (jogadores.length < formato) {
                Swal.fire({ icon: "error", title: "Erro", text: `Adicione pelo menos ${formato} jogadores`, timer: 2000, showConfirmButton: false });
                return;
            }

            // Embaralhar jogadores
            let copia = [...jogadores].sort(() => Math.random() - 0.5);

            Swal.fire({ title: "Criando equipas...", allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            try {
                // Adicionar jogadores na tabela "jogadores"
                for (const jogador of jogadores) {
                    const jogadorRef = collection(db, "jogadores");
                    // Evita duplicados pelo ID
                    const existing = await getDocs(collection(db, "jogadores"));
                    const jaExiste = existing.docs.some(docSnap => docSnap.id === jogador.id);
                    if (!jaExiste) {
                        await addDoc(jogadorRef, { id: jogador.id, nome: jogador.nome, criadoEm: new Date(), criadoPor: currentUser.email });
                    }
                }

                // Criar equipes
                while (copia.length >= formato) {
                    const equipa = copia.splice(0, formato);
                    await addDoc(collection(db, "equipas"), { equipa, criadoEm: new Date(), criadoPor: currentUser.email });
                }

                jogadores = [];
                atualizarTabelaJogadores();
                Swal.close();
                Swal.fire({ icon: "success", title: "Equipas e jogadores criados!", timer: 1500, showConfirmButton: false });
                carregarDashboard();
            } catch (e) {
                Swal.close();
                console.error(e);
                Swal.fire({ icon: "error", title: "Erro ao criar equipas ou jogadores" });
            }
        }

        // ---------------- IMPORTS FIRESTORE ----------------

        /* =====================================================
        üî• ADMIN DASHBOARD COMPLETO - MK ADMIN
        ===================================================== */


        /* =====================================================
           üöÄ INICIALIZA√á√ÉO
        ===================================================== */

        document.addEventListener("DOMContentLoaded", () => {
            configurarMenuAdmin();
            carregarSecao("dashboard");
        });


        /* =====================================================
           üìÇ MENU LATERAL (SPA)
        ===================================================== */

        function configurarMenuAdmin() {

            const items = document.querySelectorAll("#adminMenu li");

            items.forEach(item => {

                item.addEventListener("click", () => {

                    items.forEach(i => i.classList.remove("active"));
                    item.classList.add("active");

                    const secao = item.getAttribute("data-section");
                    carregarSecao(secao);
                });

            });
        }


        /* =====================================================
           üìÑ CARREGAR SEC√á√ïES
        ===================================================== */

        function carregarSecao(secao) {
            const container = document.getElementById("adminDynamicContent");
            if (!container) return;

            container.innerHTML = "";

            switch (secao) {
                case "dashboard":
                    renderDashboard(container);
                    break;
                case "eventos":
                    renderEventos(container);
                    break;
                // outras se√ß√µes...
                case "utilizadores":
                    renderUtilizadores(container);
                    break;
                case "inscricoes":
                    renderInscricoes(container);
                    break;
                case "configuracoes":
                    renderConfiguracoes(container);
                    break;
            }
        }

        // =====================================
        // EVENTO
        // =====================================
        async function renderEventos(container) {
            try {
                console.log("üîπ renderEventos iniciado");

                // ===== PEGAR EVENTOS DO FIRESTORE =====
                const eventosDisponiveisSnap = await getDocs(collection(db, "eventosDisponiveis"));
                const eventosAtivosSnap = await getDocs(collection(db, "eventosAtivos"));

                const eventosDisponiveis = eventosDisponiveisSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const eventosAtivos = eventosAtivosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                console.log("üìÑ Eventos Dispon√≠veis:", eventosDisponiveis);
                console.log("üìÑ Eventos Ativos:", eventosAtivos);

                // ===== PEGAR CARGO DO USU√ÅRIO =====
                const user = auth.currentUser;
                let userCargo = "user"; // padr√£o
                if (user) {
                    const snap = await getDocs(collection(db, "admins"));
                    let userData = null;
                    snap.forEach(docSnap => {
                        if (docSnap.data().email === user.email) {
                            userData = docSnap.data();
                            console.log("üü¢ Usu√°rio encontrado na collection 'admins':", userData);
                        }
                    });

                    if (userData) {
                        userCargo = userData.cargo || "user";
                    } else {
                        console.warn("‚ö† Usu√°rio n√£o encontrado na collection 'admins'");
                    }
                }

                const cargo = userCargo.toLowerCase();
                console.log("üîπ Cargo min√∫sculo:", cargo);

                // ===== RENDER HTML =====
                container.innerHTML = `
                <div class="admin-header">
                    <h1>Gerir Eventos</h1>
                    <div id="btnContainer"></div>
                </div>

                <!-- FORM MODAL COMPLETO PARA EVENTOS -->
                <div id="formEventoModal" class="form-modal" style="display:none;">
                    <div class="form-modal-content">
                        <h2>Criar Novo Evento</h2>

                        <form id="formNovoEvento" class="form-novo-evento">

                            <!-- Nome do Evento -->
                            <div class="form-group">
                                <label for="eventoNome">üéâ Evento <span style="color:red;">*</span></label>
                                <input type="text" id="eventoNome" placeholder="Digite o nome do evento" required>
                            </div>

                            <!-- Descri√ß√£o / T√≥pico -->
                            <div class="form-group">
                                <label for="eventoDescricao">üí¨ Descri√ß√£o do Evento</label>
                                <textarea id="eventoDescricao" placeholder="Descreva o evento detalhadamente"></textarea>
                            </div>

                            <!-- Local do Evento -->
                            <div class="form-group">
                                <label for="eventoLocal">üìç Local</label>
                                <select id="eventoLocal">
                                    <option value="">-- Selecione o local --</option>
                                    <optgroup label="-- Global --">
                                        <option value="Global">Servidor</option>
                                    </optgroup>
                                    <optgroup label="-- Favelas --">
                                        <option value="Nova Holanda">Nova Holanda</option>
                                        <option value="Helipa">Helipa</option>
                                        <option value="Cidade de Deus">Cidade de Deus</option>
                                        <option value="Alem√£o">Alem√£o</option>
                                        <option value="Antares">Antares</option>
                                        <option value="Dende">Dende</option>
                                        <option value="Salgueiro">Salgueiro</option>
                                        <option value="Israel">Israel</option>
                                        <option value="Penha">Penha</option>
                                        <option value="Rocinha">Rocinha</option>
                                        <option value="Rodo">Rodo</option>
                                        <option value="Bairro 13">Bairro 13</option>
                                    </optgroup>
                                    <optgroup label="-- Locais --">
                                        <option value="Pr√©dio">Pr√©dio</option>
                                        <option value="Fazenda">Fazenda</option>
                                        <option value="Porta Avi√µes">Porta Avi√µes</option>
                                        <option value="IATE">IATE</option>
                                        <option value="FortZancudo">Fort Zancudo</option>
                                    </optgroup>
                                </select>
                            </div>

                            <!-- Importante -->
                            <div class="form-group">
                                <label for="eventoImportante">‚ùóImportante</label>
                                <textarea id="eventoImportante" placeholder="Informa√ß√µes importantes do evento"></textarea>
                            </div>

                            <!-- Regras -->
                            <div class="form-group">
                                <label for="eventoRegras">üìñ Regras</label>
                                <textarea id="eventoRegras" placeholder="Liste as regras do evento, separadas por linha"></textarea>
                            </div>

                            <!-- Recompensa -->
                            <div class="form-group">
                                <label for="eventoRecompensa">üí∞ Recompensa</label>
                                <textarea id="eventoRecompensa" placeholder="Descreva as recompensas do evento"></textarea>
                            </div>

                            <!-- Inicio -->
                            <div class="form-group">
                                <label for="eventoInicio">‚è∞ In√≠cio</label>
                                <input type="time" id="eventoInicio" placeholder="Hora do in√≠cio">
                            </div>

                            <!-- Upload de Imagem -->
                            <div class="form-group">
                                <label for="eventoImagem">Imagem do Evento</label>
                                <input type="file" id="eventoImagem" accept="image/*">
                                <small>Dica: A imagem ser√° exibida no card do evento.</small>
                            </div>

                            <!-- Bot√µes -->
                            <div class="form-buttons">
                                <button type="submit" id="btnSalvarEvento" class="primary">Salvar Evento</button>
                                <button type="button" id="btnCancelarEvento" class="delete-btn">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <section class="eventos-section">
                    <h2>Eventos Dispon√≠veis</h2>
                    <div class="eventos-grid" id="eventosDisponiveisContainer">
                        ${eventosDisponiveis.length === 0 ? `<p>Nenhum evento dispon√≠vel.</p>` : eventosDisponiveis.map(evento => `
                            <div class="evento-card">
                                <h3>${evento.nome}</h3>
                                <p>${evento.descricao}</p>
                                ${evento.imagem ? `<img src="${evento.imagem}" alt="${evento.nome}" class="evento-img">` : ""}
                                <div class="card-actions">
                                    <button class="ativar-btn" data-id="${evento.id}">Ativar Evento</button>
                                    <button class="apagar-btn" data-id="${evento.id}"><i class="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </section>

                <section class="eventos-section">
                    <h2>Eventos Ativos</h2>
                    <div class="eventos-grid" id="eventosAtivosContainer">
                        ${eventosAtivos.length === 0 ? `<p>Nenhum evento ativo.</p>` : eventosAtivos.map(evento => `
                            <div class="evento-card active">
                                ${evento.imagem ? `<img src="${evento.imagem}" alt="${evento.nome}" class="evento-img">` : ""}
                                <h3>${evento.nome}</h3>
                                <p>${evento.descricao}</p>
                                <div class="card-actions">
                                    <button class="terminar-btn" data-id="${evento.id}">Terminar Evento</button>
                                    <button class="apagar-btn" data-id="${evento.id}"><i class="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </section>
                `;

                console.log("‚úÖ HTML renderizado");

                // ===== CRIAR BOT√ÉO PARA CEO =====
                if (cargo === "ceo") {
                    console.log("üéØ Usu√°rio √© CEO - criando bot√£o");

                    const btnContainer = container.querySelector("#btnContainer");
                    const btnCriar = document.createElement("button");
                    btnCriar.id = "btnCriarEvento";
                    btnCriar.className = "primary";
                    btnCriar.textContent = "Criar Evento";
                    btnContainer.appendChild(btnCriar);

                    console.log("üîπ Bot√£o criado e adicionado ao container:", btnCriar);

                    const modal = container.querySelector("#formEventoModal");
                    const btnCancelar = container.querySelector("#btnCancelarEvento");
                    const btnSalvar = container.querySelector("#btnSalvarEvento");
                    const inputImagem = container.querySelector("#eventoImagem");

                    btnCriar.addEventListener("click", () => {
                        console.log("üñ± Bot√£o 'Criar Evento' clicado");
                        modal.style.display = "flex";
                    });

                    btnCancelar.addEventListener("click", () => {
                        console.log("‚ùå Cancelar modal");
                        modal.style.display = "none";
                    });

                    // ===== BOT√ÉO CRIAR EVENTO =====
                    btnSalvar.addEventListener("click", async (e) => {
                        e.preventDefault();

                        const nome = container.querySelector("#eventoNome").value.trim();
                        const descricao = container.querySelector("#eventoDescricao").value.trim();
                        const local = container.querySelector("#eventoLocal").value;
                        const importante = container.querySelector("#eventoImportante").value;
                        const regras = container.querySelector("#eventoRegras").value;
                        const recompensa = container.querySelector("#eventoRecompensa").value;
                        const inicio = container.querySelector("#eventoInicio").value;
                        const inputImagem = container.querySelector("#eventoImagem");

                        if (!nome) return Swal.fire("Erro", "O nome do evento √© obrigat√≥rio!", "error");

                        let imagemBase64 = "";

                        if (inputImagem.files[0]) {
                            try {
                                imagemBase64 = await resizeImage(inputImagem.files[0], 500, 0.7);
                                console.log("‚úÖ Imagem redimensionada e comprimida:", imagemBase64.length, "bytes");
                            } catch (err) {
                                console.error("Erro ao processar imagem:", err);
                                Swal.fire("Erro", "N√£o foi poss√≠vel processar a imagem.", "error");
                                return;
                            }
                        }

                        try {
                            await addDoc(collection(db, "eventosDisponiveis"), {
                                nome,
                                descricao,
                                local,
                                importante,
                                regras,
                                recompensa,
                                inicio,
                                imagem: imagemBase64
                            });
                            console.log("‚úÖ Evento salvo no Firestore");
                            modal.style.display = "none";
                            renderEventos(container);
                        } catch (err) {
                            console.error("Erro ao salvar evento:", err);
                            Swal.fire("Erro", "N√£o foi poss√≠vel salvar o evento.", "error");
                        }
                    });
                }

                function resizeImage(file, maxWidth = 500, quality = 0.7) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement("canvas");
                                const scale = maxWidth / img.width;
                                canvas.width = maxWidth;
                                canvas.height = img.height * scale;

                                const ctx = canvas.getContext("2d");
                                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                                // converter para Base64 comprimido
                                const dataUrl = canvas.toDataURL("image/webp", quality);
                                resolve(dataUrl);
                            };
                            img.onerror = (err) => reject(err);
                            img.src = event.target.result;
                        };
                        reader.onerror = (err) => reject(err);
                        reader.readAsDataURL(file);
                    });
                }

                // ===== BOT√ïES ATIVAR EVENTO =====
                container.querySelectorAll(".ativar-btn").forEach(btn => {
                    btn.addEventListener("click", async e => {
                        const id = e.currentTarget.dataset.id;
                        console.log("‚ñ∂ Ativar evento:", id);

                        const eventoDoc = doc(db, "eventosDisponiveis", id);
                        const eventoSnap = await getDoc(eventoDoc);

                        if (eventoSnap.exists()) {
                            const data = eventoSnap.data();

                            // Envia para eventosAtivos
                            await setDoc(doc(db, "eventosAtivos", id), data);

                            // Remove de eventosDisponiveis
                            await deleteDoc(eventoDoc);

                            renderEventos(container);
                        }
                    });
                });


                // ===== BOT√ïES TERMINAR EVENTO =====
                container.querySelectorAll(".terminar-btn").forEach(btn => {
                    btn.addEventListener("click", async e => {
                        const id = e.currentTarget.dataset.id;
                        console.log("‚èπ Terminar evento:", id);

                        const eventoDoc = doc(db, "eventosAtivos", id);
                        const eventoSnap = await getDoc(eventoDoc);

                        if (eventoSnap.exists()) {
                            const data = eventoSnap.data();

                            // Envia de volta para eventosDisponiveis
                            await setDoc(doc(db, "eventosDisponiveis", id), data);

                            // Remove de eventosAtivos
                            await deleteDoc(eventoDoc);

                            renderEventos(container);
                        }
                    });
                });

                // ===== BOT√ïES APAGAR EVENTO =====
                container.querySelectorAll(".apagar-btn").forEach(btn => {
                    btn.addEventListener("click", e => {
                        const id = e.currentTarget.dataset.id;
                        console.log("üóë Apagar evento:", id);
                        Swal.fire({
                            title: "Tem a certeza?",
                            text: "Esta a√ß√£o ir√° apagar o evento permanentemente!",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#ff4d4d",
                            cancelButtonColor: "#3085d6",
                            confirmButtonText: "Sim, apagar!",
                            cancelButtonText: "Cancelar"
                        }).then(async (result) => {
                            if (result.isConfirmed) {
                                await deleteDoc(doc(db, "eventosDisponiveis", id)).catch(() => { });
                                await deleteDoc(doc(db, "eventosAtivos", id)).catch(() => { });
                                renderEventos(container);
                            }
                        });
                    });
                });

                console.log("üîπ renderEventos finalizado");

            } catch (err) {
                console.error("Erro ao carregar eventos:", err);
                container.innerHTML = "<p>Erro ao carregar eventos.</p>";
            }
        }


        /* =====================================================
           üìä DASHBOARD
        ===================================================== */

        function renderDashboard(container) {

            container.innerHTML = `
            <div class="admin-header">
                <h1>Dashboard Geral</h1>
            </div>

            <div class="admin-stats">
                <div class="stat-card">
                    <h3 id="totalUsers">0</h3>
                    <p>Total Utilizadores</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalAdmins">0</h3>
                    <p>Admins</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalMods">0</h3>
                    <p>Moderadores</p>
                </div>
            </div>
        `;

            carregarDashboardStats();
        }

        async function carregarDashboardStats() {
            try {
                const snap = await getDocs(collection(db, "admins"));

                const totalUsers = snap.size;
                let totalAdmins = 0;
                let totalMods = 0;

                snap.forEach(docSnap => {
                    const d = docSnap.data();
                    if (d.cargo === "admin") totalAdmins++;
                    if (d.cargo === "moderador") totalMods++;
                });

                document.getElementById("totalUsers").textContent = totalUsers;
                document.getElementById("totalAdmins").textContent = totalAdmins;
                document.getElementById("totalMods").textContent = totalMods;

            } catch (e) {
                console.error("Erro ao carregar estat√≠sticas do dashboard:", e);
            }
        }

        /* =====================================================
           üë§ UTILIZADORES
        ===================================================== */

        function renderUtilizadores(container) {

            container.innerHTML = `
                <div class="admin-header">
                    <h1>Gest√£o de Utilizadores</h1>
                    <button class="primary" id="btnNovoUser">+ Novo Utilizador</button>
                </div>

                <div class="admin-table-card">
                    <div class="table-header">
                        <input type="text" id="searchUser" placeholder="üîç Pesquisar utilizador...">
                    </div>

                    <div class="table-wrapper">
                        <table id="adminTable">
                            <thead>
                                <tr>
                                    <th>Utilizador</th>
                                    <th>Email</th>
                                    <th>Cargo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById("btnNovoUser")
                .addEventListener("click", () => criarOuEditarUser());

            carregarAdminPanel();
        }


        /* =====================================================
   üéÆ JOGADORES - CRUD COMPLETO
===================================================== */

        async function carregarJogadores() {
            const container = document.getElementById("listaJogadores");
            if (!container) return;

            container.innerHTML = ""; // limpa lista
            try {
                const snap = await getDocs(collection(db, "jogadores"));

                if (snap.empty) {
                    container.innerHTML = `<p style="text-align:center; color:#888;">Nenhum jogador registado.</p>`;
                    return;
                }

                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    const tr = document.createElement("div");
                    tr.classList.add("player-card");
                    tr.innerHTML = `
                        <div>
                            <strong>ID:</strong> ${data.id || "-"}<br>
                            <strong>Nome:</strong> ${data.nome || "-"}
                        </div>
                        <div class="player-actions">
                            <button class="edit-btn"><i class="fa-solid fa-pen"></i> Editar</button>
                            <button class="delete-btn"><i class="fa-solid fa-trash"></i> Deletar</button>
                        </div>
                    `;
                    container.appendChild(tr);

                    // Editar jogador
                    tr.querySelector(".edit-btn").addEventListener("click", () => criarOuEditarJogador(docSnap.id));

                    // Deletar jogador
                    tr.querySelector(".delete-btn").addEventListener("click", () => deletarJogador(docSnap.id));
                });

            } catch (e) {
                console.error("Erro ao carregar jogadores:", e);
                container.innerHTML = `<p style="color:red;">Erro ao carregar jogadores</p>`;
            }
        }

        async function criarOuEditarJogador(docId = null) {
            let jogadorData = { id: "", nome: "" };

            if (docId) {
                const snap = await getDoc(doc(db, "jogadores", docId));
                if (snap.exists()) jogadorData = snap.data();
            }

            const { value: formValues } = await Swal.fire({
                title: docId ? "Editar Jogador" : "Criar Jogador",
                html: `
                    <input id="swalJogadorID" class="swal2-input" placeholder="ID do Jogador" value="${jogadorData.id}">
                    <input id="swalJogadorNome" class="swal2-input" placeholder="Nome do Jogador" value="${jogadorData.nome}">
                `,
                showCancelButton: true,
                preConfirm: () => ({
                    id: document.getElementById("swalJogadorID").value.trim(),
                    nome: document.getElementById("swalJogadorNome").value.trim()
                })
            });

            if (!formValues) return;

            try {
                if (!formValues.id || !formValues.nome) {
                    Swal.fire({ icon: "error", title: "ID e Nome s√£o obrigat√≥rios!" });
                    return;
                }

                if (docId) {
                    // Atualizar jogador existente
                    await updateDoc(doc(db, "jogadores", docId), formValues);
                    Swal.fire({ icon: "success", title: "Jogador atualizado!" });
                } else {
                    // Criar novo jogador
                    await addDoc(collection(db, "jogadores"), formValues);
                    Swal.fire({ icon: "success", title: "Jogador criado!" });
                }

                carregarJogadores();
            } catch (e) {
                console.error("Erro ao salvar jogador:", e);
                Swal.fire({ icon: "error", title: "Erro ao salvar jogador" });
            }
        }

        async function deletarJogador(docId) {
            const result = await Swal.fire({
                icon: "warning",
                title: "Tem certeza?",
                text: "Esta a√ß√£o n√£o pode ser desfeita!",
                showCancelButton: true,
                confirmButtonText: "Sim, deletar",
                cancelButtonText: "Cancelar"
            });

            if (!result.isConfirmed) return;

            try {
                await deleteDoc(doc(db, "jogadores", docId));
                Swal.fire({ icon: "success", title: "Jogador deletado!", timer: 1200, showConfirmButton: false });
                carregarJogadores();
            } catch (e) {
                console.error("Erro ao deletar jogador:", e);
                Swal.fire({ icon: "error", title: "Erro ao deletar jogador" });
            }
        }

        /* =====================================================
           Fun√ß√£o principal de renderiza√ß√£o da se√ß√£o Jogadores
        ===================================================== */
        function renderJogadores(container) {
            container.innerHTML = `
                <div class="admin-header">
                    <h1>Gest√£o de Jogadores</h1>
                    <button class="primary" id="btnNovoJogador">+ Novo Jogador</button>
                </div>

                <div class="admin-table-card" style="margin-top:15px;">
                    <div id="listaJogadores" class="players-grid">
                        <p style="text-align:center; color:#888;">Carregando jogadores...</p>
                    </div>
                </div>
            `;

            document.getElementById("btnNovoJogador").addEventListener("click", () => criarOuEditarJogador());

            carregarJogadores();
        }

        /* =====================================================
           Inscri√ß√µes (Admin)
        ===================================================== */

        function renderInscricoes(container) {
            container.innerHTML = `
                <div class="admin-header">
                    <h1>Inscri√ß√µes por Evento</h1>
                </div>

                <div class="admin-table-card" style="margin-top:15px;">
                    <div id="listaInscricoes">
                        <p style="text-align:center; color:#888; padding:20px;">Carregando inscri√ß√µes...</p>
                    </div>
                </div>
            `;

            carregarInscricoes();
        }

        async function carregarInscricoes() {
            const container = document.getElementById('listaInscricoes');
            if (!container) return;
            container.innerHTML = '';

            try {
                const eventosSnap = await getDocs(collection(db, 'eventosAtivos'));
                if (eventosSnap.empty) {
                    container.innerHTML = '<p style="color:#ccc; text-align:center;">Nenhum evento ativo.</p>';
                    return;
                }

                // Construir tabela
                let html = `<table style="width:100%; border-collapse:collapse;"><thead><tr style="text-align:left;"><th>Evento</th><th>Total Inscri√ß√µes</th><th>A√ß√µes</th></tr></thead><tbody>`;

                for (const docSnap of eventosSnap.docs) {
                    const ev = { id: docSnap.id, ...docSnap.data() };

                    // Contar inscri√ß√µes para este evento (collection: incricoes)
                    const q = query(collection(db, 'incricoes'), where('eventId', '==', ev.id));
                    const inscritosSnap = await getDocs(q);
                    const total = inscritosSnap.size;

                    html += `<tr><td style="padding:10px 8px;">${ev.nome || ev.id}</td>`;
                    html += `<td style="padding:10px 8px;">${total}</td>`;
                    html += `<td style="padding:10px 8px;"><button class="verInscritosBtn" data-eventid="${ev.id}" style="padding:6px 10px;border-radius:6px;border:none;background:#5865F2;color:#fff;cursor:pointer">Ver inscritos</button></td></tr>`;
                }

                html += '</tbody></table>';
                container.innerHTML = html;

                // Liga bot√µes
                container.querySelectorAll('.verInscritosBtn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const eventId = btn.getAttribute('data-eventid');
                        const snap = await getDocs(query(collection(db, 'incricoes'), where('eventId', '==', eventId)));
                        if (snap.empty) {
                            Swal.fire({ icon: 'info', title: 'Sem inscri√ß√µes', text: 'Ningu√©m inscreveu-se neste evento ainda.' });
                            return;
                        }

                        // Construir lista HTML
                        let listHtml = `<div style="max-height:360px;overflow:auto;text-align:left;">`;
                        listHtml += `<table style="width:100%;border-collapse:collapse;"><thead><tr><th style="text-align:left;padding:6px">Discord ID</th><th style="text-align:left;padding:6px">Player ID</th><th style="text-align:left;padding:6px">Data</th></tr></thead><tbody>`;

                        snap.forEach(s => {
                            const d = s.data();
                            const dt = d.timestamp ? new Date(d.timestamp.seconds ? d.timestamp.seconds * 1000 : d.timestamp).toLocaleString() : '';
                            listHtml += `<tr><td style="padding:6px;border-top:1px solid #222;">${d.discordId || '‚Äî'}</td><td style="padding:6px;border-top:1px solid #222;">${d.playerId || '‚Äî'}</td><td style="padding:6px;border-top:1px solid #222;">${dt}</td></tr>`;
                        });

                        listHtml += `</tbody></table></div>`;

                        Swal.fire({ title: 'Inscritos', html: listHtml, width: '720px' });
                    });
                });

            } catch (err) {
                console.error('Erro ao carregar inscri√ß√µes:', err);
                container.innerHTML = '<p style="color:red; text-align:center;">Erro ao carregar inscri√ß√µes.</p>';
            }
        }


        /* =====================================================
           ‚öôÔ∏è CONFIGURA√á√ïES
        ===================================================== */

        function renderConfiguracoes(container) {

            container.innerHTML = `
        <div class="admin-header">
            <h1>Configura√ß√µes</h1>
        </div>

        <div class="admin-table-card">
            <p>Configura√ß√µes do sistema ‚öôÔ∏è</p>
        </div>
    `;
        }


        /* =====================================================
           üìã CARREGAR ADMIN PANEL (TABELA + STATS)
        ===================================================== */

        async function carregarAdminPanel() {

            const tbody = document.querySelector("#adminTable tbody");
            if (!tbody) return;

            const totalUsersEl = document.getElementById("totalUsers");
            const totalAdminsEl = document.getElementById("totalAdmins");
            const totalModsEl = document.getElementById("totalMods");
            const searchInput = document.getElementById("searchUser");

            tbody.innerHTML = "";

            let totalUsers = 0;
            let totalAdmins = 0;
            let totalMods = 0;

            try {

                const snap = await getDocs(collection(db, "admins"));

                snap.forEach(docSnap => {

                    const d = docSnap.data();
                    totalUsers++;

                    if (d.cargo === "admin") totalAdmins++;
                    if (d.cargo === "moderador") totalMods++;

                    const tr = document.createElement("tr");

                    tr.innerHTML = `
                <td>
                    <div class="user-cell">
                        <img class="user-avatar"
                            src="${d.photoBase64 && d.photoBase64.startsWith("data:")
                            ? d.photoBase64
                            : "https://via.placeholder.com/40"}">
                        <span>${d.nome || "-"}</span>
                    </div>
                </td>
                <td>${d.email || "-"}</td>
                <td>${d.cargo || "-"}</td>
                <td>
                    <button class="action-btn edit-btn">Editar</button>
                    <button class="action-btn delete-btn">Eliminar</button>
                    <button class="action-btn view-btn">Ver</button>
                </td>
            `;

                    tbody.appendChild(tr);

                    tr.querySelector(".edit-btn")
                        .addEventListener("click", () => criarOuEditarUser(docSnap.id));

                    tr.querySelector(".delete-btn")
                        .addEventListener("click", () => deletarUser(docSnap.id));

                    tr.querySelector(".view-btn")
                        .addEventListener("click", () => verUser(docSnap.id));
                });

                if (totalUsersEl) totalUsersEl.textContent = totalUsers;
                if (totalAdminsEl) totalAdminsEl.textContent = totalAdmins;
                if (totalModsEl) totalModsEl.textContent = totalMods;

                if (searchInput) {
                    searchInput.addEventListener("input", function () {

                        const value = this.value.toLowerCase();

                        document.querySelectorAll("#adminTable tbody tr")
                            .forEach(row => {
                                row.style.display =
                                    row.innerText.toLowerCase().includes(value)
                                        ? ""
                                        : "none";
                            });
                    });
                }

            } catch (e) {
                console.error("Erro ao carregar admins:", e);
            }
        }


        /* =====================================================
           ‚úèÔ∏è CRIAR / EDITAR UTILIZADOR
        ===================================================== */

        async function criarOuEditarUser(docId = null) {

            let userData = { nome: "", email: "", cargo: "user", senha: "", photoBase64: "" };

            if (docId) {
                const snap = await getDoc(doc(db, "admins", docId));
                if (snap.exists()) userData = snap.data();
            }

            const { value: formValues } = await Swal.fire({

                title: docId ? "Editar Usu√°rio" : "Criar Usu√°rio",

                html: `
            <input id="swalNome" class="swal2-input" placeholder="Nome" value="${userData.nome}">
            <input id="swalEmail" class="swal2-input" placeholder="Email" value="${userData.email}">
            <input id="swalSenha" type="password" class="swal2-input" placeholder="Senha (opcional)">
            <select id="swalCargo" class="swal2-select">
                <option value="ceo">CEO</option>
                <option value="admin">Admin</option>
                <option value="moderador">Moderador</option>
                <option value="user">Jogador</option>
            </select>
        `,

                showCancelButton: true,

                preConfirm: () => ({
                    nome: document.getElementById("swalNome").value.trim(),
                    email: document.getElementById("swalEmail").value.trim(),
                    cargo: document.getElementById("swalCargo").value,
                    senha: document.getElementById("swalSenha").value
                })
            });

            if (!formValues) return;

            try {

                if (docId) {

                    const dataToUpdate = { ...formValues };
                    if (!dataToUpdate.senha) delete dataToUpdate.senha;

                    await updateDoc(doc(db, "admins", docId), dataToUpdate);

                    Swal.fire({ icon: "success", title: "Atualizado!" });

                } else {

                    if (!formValues.senha) {
                        Swal.fire({ icon: "error", title: "Defina uma senha!" });
                        return;
                    }

                    await createUserWithEmailAndPassword(auth, formValues.email, formValues.senha);
                    await addDoc(collection(db, "admins"), formValues);

                    Swal.fire({ icon: "success", title: "Criado!" });
                }

                carregarAdminPanel();

            } catch (e) {
                console.error(e);
                Swal.fire({ icon: "error", title: "Erro ao salvar" });
            }
        }


        /* =====================================================
           üóëÔ∏è DELETAR
        ===================================================== */

        async function deletarUser(docId) {

            const result = await Swal.fire({
                icon: "warning",
                title: "Tem certeza?",
                showCancelButton: true
            });

            if (!result.isConfirmed) return;

            await deleteDoc(doc(db, "admins", docId));

            Swal.fire({ icon: "success", title: "Deletado!", timer: 1200, showConfirmButton: false });

            carregarAdminPanel();
        }


        /* =====================================================
           üëÅÔ∏è VER DETALHES
        ===================================================== */

        async function verUser(docId) {

            const snap = await getDoc(doc(db, "admins", docId));
            if (!snap.exists()) return;

            const data = snap.data();

            Swal.fire({
                title: data.nome,
                html: `
            <p><strong>Email:</strong> ${data.email}</p>
            <p><strong>Cargo:</strong> ${data.cargo}</p>
        `
            });
        }

        // ------------------
        // Configura√ß√£o Bot√£o
        // ------------------
        // Open settings modal (custom Discord-like)
        document.getElementById("btnSettings").onclick = () => {
            const overlay = document.getElementById("settingsModalOverlay");
            const nomeInput = document.getElementById("settingsNome");
            const temaSelect = document.getElementById("settingsTema");
            const fotoPreview = document.getElementById("settingsFotoPreview");
            const fotoInput = document.getElementById("settingsFoto");
            const saveBtn = document.getElementById("settingsSave");

            const isAuthed = !!currentUser;

            // Preencher valores
            nomeInput.value = currentUserNome || "";
            nomeInput.disabled = !isAuthed; // s√≥ editar se autenticado

            const temaAtual = document.body.classList.contains("light") ? "light" : "dark";
            temaSelect.value = temaAtual;
            temaSelect.disabled = false; // tema pode ser trocado mesmo para visitantes

            fotoInput.disabled = !isAuthed; // bloquear upload para visitantes
            saveBtn.disabled = !isAuthed; // bloquear salvar para visitantes

            fotoPreview.style.display = "none";
            fotoPreview.src = "";

            // Inserir aviso para visitantes
            const content = overlay.querySelector('.settings-content');
            let notice = document.getElementById('settingsReadOnlyNotice');
            if (!notice) {
                notice = document.createElement('p');
                notice.id = 'settingsReadOnlyNotice';
                notice.style.margin = '8px 0 12px 0';
                notice.style.color = '#cbd7ee';
                notice.style.fontSize = '13px';
                content.insertBefore(notice, content.firstChild);
            }
            if (!isAuthed) {
                notice.textContent = 'Fa√ßa login para alterar nome e foto.';
                notice.style.display = 'block';
            } else {
                notice.style.display = 'none';
            }

            overlay.style.display = "flex";
            overlay.setAttribute("aria-hidden","false");
            // Mostrar a se√ß√£o ativa (ou perfil por defeito)
            const activeLi = overlay.querySelector('.settings-sidebar ul li.active');
            const initialSection = activeLi ? activeLi.getAttribute('data-section') : 'profile';
            if (window.showSettingsSection) window.showSettingsSection(initialSection);
        };

        // Fun√ß√£o para alternar se√ß√µes do modal de configura√ß√µes
        function showSettingsSection(section) {
            const sidebarItems = document.querySelectorAll('.settings-sidebar ul li');
            sidebarItems.forEach(li => li.classList.toggle('active', li.getAttribute('data-section') === section));

            const panels = {
                profile: document.getElementById('settingsProfile'),
                appearance: document.getElementById('settingsAppearance'),
                account: document.getElementById('settingsAccount')
            };

            Object.keys(panels).forEach(key => {
                if (!panels[key]) return;
                panels[key].style.display = (key === section) ? 'block' : 'none';
            });
        }

        // Liga clicks da sidebar √†s se√ß√µes
        (function initSettingsTabs() {
            const sidebar = document.querySelector('.settings-sidebar ul');
            if (!sidebar) return;
            sidebar.querySelectorAll('li').forEach(li => {
                li.addEventListener('click', () => {
                    const s = li.getAttribute('data-section');
                    showSettingsSection(s);
                });
            });

            // Aplicar tema imediatamente quando alterado
            const temaSelect = document.getElementById('settingsTema');
            if (temaSelect) {
                temaSelect.addEventListener('change', (e) => {
                    const v = e.target.value;
                    if (v === 'light') document.body.classList.add('light');
                    else document.body.classList.remove('light');
                });
            }
        })();

        // Modal controls
        document.getElementById("settingsClose").onclick = hideSettingsModal;
        document.getElementById("settingsCancel").onclick = hideSettingsModal;
        document.getElementById("settingsFoto").addEventListener("change", (e) => {
            if (e.target.disabled) return; // proteger upload quando desabilitado
            const f = e.target.files[0];
            const p = document.getElementById("settingsFotoPreview");
            if (!f) { p.style.display = "none"; p.src = ""; return; }
            const r = new FileReader(); r.onload = (ev) => { p.src = ev.target.result; p.style.display = "block"; }; r.readAsDataURL(f);
        });

        async function hideSettingsModal() {
            const overlay = document.getElementById("settingsModalOverlay");
            overlay.style.display = "none";
            overlay.setAttribute("aria-hidden","true");
        }

        document.getElementById("settingsSave").onclick = async () => {
            if (!currentUser) {
                await Swal.fire({ icon: 'info', title: 'Fa√ßa login', text: 'Fa√ßa login para alterar as configura√ß√µes.' });
                return;
            }

            const nome = document.getElementById("settingsNome").value.trim();
            const tema = document.getElementById("settingsTema").value;
            const fotoFile = document.getElementById("settingsFoto").files[0];

            try {
                let docId = null;
                if (currentUser && currentUser.email) {
                    const snap = await getDocs(collection(db, "admins"));
                    snap.forEach(docSnap => { if (docSnap.data().email === currentUser.email) docId = docSnap.id; });
                }

                if (docId && nome) {
                    await updateDoc(doc(db, "admins", docId), { nome });
                    currentUserNome = nome;
                    document.getElementById("userNomeSidebar").innerText = nome;
                }

                // Tema
                if (tema === "light") { document.body.classList.add("light"); localStorage.setItem("temaMK","light"); }
                else { document.body.classList.remove("light"); localStorage.setItem("temaMK","dark"); }

                if (fotoFile && docId) {
                    Swal.fire({ title: "Enviando foto...", allowOutsideClick:false, didOpen: () => Swal.showLoading() });
                    const reader = new FileReader();
                    reader.onload = async (ev) => {
                        const base64 = ev.target.result;
                        await updateDoc(doc(db, "admins", docId), { photoBase64: base64 });
                        document.getElementById("userPhoto").src = base64;
                        document.getElementById("mobileUserPhoto").src = base64;
                        Swal.close();
                        Swal.fire({ icon: "success", title: "Configura√ß√µes guardadas" });
                        hideSettingsModal();
                    };
                    reader.readAsDataURL(fotoFile);
                } else {
                    Swal.fire({ icon: "success", title: "Configura√ß√µes guardadas" });
                    hideSettingsModal();
                }
            } catch (err) {
                console.error(err);
                Swal.fire({ icon: "error", title: "Erro ao guardar" });
            }
        };

        document.getElementById("btnLogoutIcon").onclick = async () => {

            const confirm = await Swal.fire({
                icon: "warning",
                title: "Sair da conta?",
                text: "Tem certeza que deseja terminar a sess√£o?",
                showCancelButton: true,
                confirmButtonText: "Sim, sair",
                cancelButtonText: "Cancelar"
            });

            if (confirm.isConfirmed) {
                await signOut(auth);
                window.location.href = "login.html";
            }
        };

        async function atualizarSidebar(userData) {
            // Foto
            const userPhoto = document.getElementById("userPhoto");
            const userPhotoMobile = document.getElementById("mobileUserPhoto")
            userPhoto.src = userData.photoBase64 || userData.photoURL || "https://i.imgur.com/4Z7Dz7S.png";
            userPhotoMobile.src = userData.photoBase64 || userData.photoUrl;

            // Nome
            const userNome = document.getElementById("userNomeSidebar");
            userNome.textContent = userData.nome || "Nome";

            // ID
            const userId = document.getElementById("userIdSidebar");
            userId.textContent = userData.id || "Id"

            // Cargo
            const cargoSpan = document.getElementById("userCargoSidebar");
            cargoSpan.className = ""; // limpa classes anteriores

            const cargo = (userData.cargo || "user").toLowerCase();

            switch (cargo) {
                case "ceo":
                    cargoSpan.classList.add("badgeCargo", "badgeCEO");
                    cargoSpan.textContent = "üëë CEO";
                    break;
                case "admin":
                    cargoSpan.classList.add("badgeCargo", "badgeAdmin");
                    cargoSpan.textContent = "üõ°Ô∏è Admin";
                    break;
                case "moderador":
                    cargoSpan.classList.add("badgeCargo", "badgeModerador");
                    cargoSpan.textContent = "‚öîÔ∏è Moderador";
                    break;
                default:
                    cargoSpan.classList.add("badgeCargo", "badgeUser");
                    cargoSpan.textContent = "üë§ Usu√°rio";
                    break;
            }
        }

        // ------------------------- AUTH ---------------------------
        onAuthStateChanged(auth, async user => {
            if (user) {
                const entrarBtn = document.getElementById("btnEntrarTop");
                if (entrarBtn) entrarBtn.style.display = "none";
                currentUser = user;

                try {
                    // Buscar o admin correspondente ao usu√°rio logado
                    const snap = await getDocs(collection(db, "admins"));
                    let userData = null;
                    snap.forEach(docSnap => {
                        if (docSnap.data().email === user.email) {
                            userData = docSnap.data();
                            userData.docId = docSnap.id;
                        }
                    });

                    if (!userData) {
                        Swal.fire({ icon: "error", title: "Sem permiss√£o", text: "Seu usu√°rio n√£o √© admin", timer: 2500, showConfirmButton: false });
                        document.getElementById("mainContent").innerHTML = "<p>Voc√™ n√£o tem permiss√£o para acessar este dashboard.</p>";
                        return;
                    }

                    // Cargo do usu√°rio logado
                    const userCargo = (userData.cargo || "user").toLowerCase();
                    currentUserNome = userData.nome;
                    currentUserId = userData.id
                    currentUserRole = userData.cargo;

                    // Mostrar bot√£o Admin s√≥ se CEO
                    if (userCargo === "ceo") {
                        document.getElementById("btnAdmin").style.display = "flex";
                    }

                    // Atualiza sidebar e tema...
                    await atualizarSidebar(userData);
                    // mostrar elementos da sidebar quando autenticado
                    const sidId = document.getElementById("userIdSidebar");
                    const sidCargo = document.getElementById("userCargoSidebar");
                    const btnSettingsEl = document.getElementById("btnSettings");
                    const btnLogoutEl = document.getElementById("btnLogoutIcon");
                    if (sidId) sidId.style.display = "block";
                    if (sidCargo) sidCargo.style.display = "inline-block";
                    if (btnSettingsEl) btnSettingsEl.style.display = "inline-flex";
                    if (btnLogoutEl) btnLogoutEl.style.display = "inline-flex";
                    const temaSalvo = localStorage.getItem("temaMK");
                    if (temaSalvo === "light") document.body.classList.add("light");

                    // Carrega a se√ß√£o eventos passando o cargo
                    // depois de definir currentUserRole
                    carregarSecao("eventos", currentUserRole);
                    mostrarSecao("Dashboard");

                } catch (e) {
                    console.error(e);
                    Swal.fire({ icon: "error", title: "Erro", text: "N√£o foi poss√≠vel carregar os dados", timer: 2500, showConfirmButton: false });
                }
            } else {
                const entrarBtn = document.getElementById("btnEntrarTop");
                if (entrarBtn) entrarBtn.style.display = "block";
                currentUser = null;
                currentUserNome = "Jogador";
                currentUserId = "Usu√°rio";
                currentUserRole = "user";
                await atualizarSidebar({ nome: currentUserNome, id: currentUserId, cargo: currentUserRole });
                // esconder detalhes para visitante, manter apenas configura√ß√µes vis√≠vel
                const sidIdG = document.getElementById("userIdSidebar");
                const sidCargoG = document.getElementById("userCargoSidebar");
                const btnSettingsG = document.getElementById("btnSettings");
                const btnLogoutG = document.getElementById("btnLogoutIcon");
                if (sidIdG) sidIdG.style.display = "none";
                if (sidCargoG) sidCargoG.style.display = "none";
                if (btnSettingsG) btnSettingsG.style.display = "inline-flex";
                if (btnLogoutG) btnLogoutG.style.display = "none";
                const temaSalvo = localStorage.getItem("temaMK");
                if (temaSalvo === "light") document.body.classList.add("light");
                carregarSecao("eventos", currentUserRole);
                mostrarSecao("Dashboard");
            }
        });

        // ---------------- SIDEBAR ----------------
        document.getElementById("btnDashboard").onclick = () => mostrarSecao("Dashboard");
        document.getElementById("btnEventos").onclick = () => mostrarSecao("Eventos");
        document.getElementById("btnAdmin").onclick = () => mostrarSecao("Admin");
        const entrarTop = document.getElementById("btnEntrarTop");
        if (entrarTop) entrarTop.onclick = () => { window.location.href = "login.html"; };
    </script>
    <script>
        function handleMobileUserPhoto() {
            const photo = document.getElementById("mobileUserPhoto");
            const originalPhoto = document.getElementById("userPhoto");

            if (window.innerWidth <= 900) {
                photo.style.display = "block";
                photo.src = originalPhoto.src;
            } else {
                photo.style.display = "none";
            }
        }

        window.addEventListener("resize", handleMobileUserPhoto);
        window.addEventListener("load", handleMobileUserPhoto);
    </script>
</body>

</html>